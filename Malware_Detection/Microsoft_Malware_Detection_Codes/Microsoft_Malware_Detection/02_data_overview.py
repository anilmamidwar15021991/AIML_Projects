# 01. setup
import numpy as np
import pandas as pd

# Data Visualization
import seaborn as sns
import matplotlib.pyplot as plt
import matplotlib.lines as mlines
import plotly.offline as py
import plotly.graph_objs as go
import plotly.tools as tls

# Track time
import time
import datetime

# Machine Learning
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split, GridSearchCV
from sklearn.metrics import confusion_matrix , classification_report, accuracy_score
from sklearn.metrics import roc_auc_score, plot_roc_curve, precision_recall_curve, plot_precision_recall_curve
from sklearn.linear_model import LogisticRegression
from sklearn.tree import DecisionTreeClassifier
from sklearn.ensemble import RandomForestClassifier
from xgboost import XGBClassifier
from lightgbm import LGBMClassifier
from scipy.stats import chi2_contingency, f_oneway

import gc
import warnings
from tqdm import tqdm_notebook


# Set Options
pd.set_option('display.max_rows', 800)
pd.set_option('display.max_columns', 500)
plt.style.use('ggplot')
py.init_notebook_mode(connected=False) # To work offline
warnings.filterwarnings("ignore")
# %matplotlib inline


# 2. Data Overview
nrows = 4000000  # reduce/increase if needed
train = pd.read_csv('Data/Input/malware_df.csv', nrows = nrows)
train.sample(6)


# Data Description
"""
The telemetry data containing these properties and the machine infections was generated by combining heartbeat 
and threat reports collected by Microsoft's endpoint protection solution, Windows Defender.
Each row in this dataset corresponds to a machine, uniquely identified by a MachineIdentifier. 
HasDetections is the ground truth and indicates that Malware was detected on the machine.
The sampling methodology used to create this dataset was designed to meet certain business constraints, 
both in regards to user privacy as well as the time period during which the machine was running. 
Malware detection is inherently a time-series problem, but it is made complicated by the introduction of new machines, 
machines that come online and offline, machines that receive patches, machines that receive new operating systems, etc. 
Additionally, this dataset is not representative of Microsoft customersâ€™ machines in the wild; it has been sampled 
to include a much larger proportion of malware machines.
"""